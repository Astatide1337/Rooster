/**
 * üêì Feed the Rooster - Console Easter Egg Game
 * 
 * A fun console game for curious developers who open the DevTools.
 * Type `rooster.help()` to get started!
 */

const roosterGame = () => {
  // Game state (persisted in localStorage)
  const STORAGE_KEY = 'rooster_game_state'

  const getState = () => {
    try {
      const saved = localStorage.getItem(STORAGE_KEY)
      return saved ? JSON.parse(saved) : { feeds: 0, stage: 0, hatched: false }
    } catch {
      return { feeds: 0, stage: 0, hatched: false }
    }
  }

  const saveState = (state) => {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state))
    } catch { 
      // ignore
    }
  }

  let state = getState()

  // --- Large ASCII Art Assets ---
  const stages = [
    {
      name: 'Mystery Egg',
      feedsNeeded: 3,
      message: "A pristine white egg. It feels warm to the touch.",
      art: `                                                  
                                           .-**********-.                                           
                                        .+#+=----------=+#+.                                        
                                      -@*--:::::::---------+@-                                      
                                   .-#+-::::::::::-----------=#=.                                   
                                 .-#+-::::::::::::-------------+#-.                                 
                                :**-::::::::::::::---------------**:                                
                              .-#=-::::::::::::::-----------------=#-.                              
                              =#--:::::::::::::::-------------------#=                              
                              .**--:::::::::::::::---------------------*#.                            
                           .*+---::::::::::::::-----------------------+#.                           
                          .*+---::::::::::::::-------------------------+*.                          
                         .+*----::::::::::::----------------------------*+.                         
                         =#------::::::::::------------------------------#=                         
                        :@--------::::::----------------==----------------%:                        
                       .%=---------------+*#-----------++#+---------------=%.                       
                      .+*---------------=--#=----------*.**----------------+*.                      
                      :#-----------------#%%=----------*#%+----------------=#:                      
                     .++--------::....:--=*=------------++---:....:---------++.                     
                     :*=---------:...::-------=+----+=-------::...:---------=*:                     
                    .-*------------------------+#++#+------------------------*-.                    
                    .=*------------------------------------------------------*=.                    
                    .++------------------------------------------------------++.                    
                    .*=------------------------------------------------------=*.                    
                    .#=------------------------------------------------------=#.                    
                    .#=------------------------------------------------------=#.                    
                    .#=------------------------------------------------------=*.                    
                    .*+------------------------------------------------------+*.                    
                    .++------------------------------------------------------++.                    
                    .-*------------------------------------------------------*-.                    
                     :*=----------------------------------------------------=*:                     
                     .++----------------------------------------------------++.                     
                      -#---------------------------------------------------=*-                      
                      .+*--------------------------------------------------*+.                      
                       .#+------------------------------------------------+#.                       
                        .#+----------------------------------------------+#.                        
                         .*+--------------------------------------------+*.                         
                          .**------------------------------------------+*.                          
                           .=#=--------------------------------------=#=.                           
                             .+#=----------------------------------=**.                             
                              .:+#=------------------------------=#+:.                              
                                ..-%*--------------------------*%=..                                
                                    .=##+==--------------==+##=.                                    
                                        .:+******++******+-.`
    },
    {
      name: 'Cracking Egg',
      feedsNeeded: 5,
      message: "Fractures are appearing on the shell! Something is trying to get out.",
      art: `
                                               .........                                            
                                         ...................                                        
                                      .........................                                     
                                  .................................                              
                                 ....................................                               
                                ......................................                            
                             ...........................................                            
                            ............................................                            
                          ................................................                          
                         ..................................................                         
                        .....................................................                       
                       ......................................................                       
                      .........................................................                     
                     ..........................................................                     
                    .............................................................                   
                   ...............................................................             
                  .................................................................            
                  .................................................................            
                ...................................................................                 
                ....................................................................                
                ....................................................................                
               ..:-..................................................................               
              .:-:::..................................................................              
              ....:-................................:..............::-:...............              
              ....:-...............................-..-=:.........-:...:-:..............            
              .....-:.............................-:.....:-....:==-.......-=-...........            
             ......:-............................:-.............................----:...            
             .......::..........................:-...................................:..            
             .......:-........................:-........................................            
             ........-:...............:.....:-:.........................................            
             ........:-..............::-..:-:...........................................            
             .........--............-:..--:.............................................            
             ..........:-..........:-...................................................            
              ..........:-........:-....................................................            
              ...........:-......:-.....................................................            
              ............:-.....-:....................................................             
              .............:-:..::....................................................              
                ..............-:::....................................................               
               ...............:-....................................................                
               .....................................................................                
                 ...................................................................                
                  ................................................................                  
                   ...............................................................                  
                     ..........................................................                     
                      .........................................................                     
                         ......................................................                     
                          ................................................                          
                            ............................................                            
                                ........................................                            
                                 .. ...............................`
    },
    {
      name: 'Baby Chick',
      feedsNeeded: 8,
      message: "A fuzzy chick has hatched! 'Peep peep!'",
      art: `                                                                                                       
                                                   .::::........                                                   
                                                   ..::::::::...                                                   
                                                   ...::::::.....                                                  
                                                .::::::::::::::::..                                                
                                             ..:::::::::::::::::::::...                                            
                                           ..::::::::::::::::::::::::..                                            
                                          ..:::::::::::::::::::::::::::..                                          
                                          .:::::::::::::::::::::::::::::.                                          
                                        ..::::::::::::::::::::::::::::::..                                         
                                        ..:::::-##%+:::::::::::*#%#-:::::.                                         
                                        ..:::::=%#%%::::::::::-%#%%-:::::.                                         
                                        ..:::::::--::::-----::::--:::::::.                                         
                                        ..::::::::::-----------::::::::::.                                         
                                        ..::::::::::::-------:::::::::::..                                         
                                       ....::::::::::::::-::::::::::::::....                                       
                                     ...:----:::::::::::::::::::::::::-----:...                                    
                                    ..--------:::::::::::::::::::::::--------:.                                    
                                  ..:---------::::::::::::::::::::::::---:..:-:.                                   
                                 ..:---------:::::::::::::::::::::::::-:....:--:..                                 
                                 .:--::...:-::::::::::::::::::::::::::.......:--:..                                
                                 .-:........:::::::::::::::::::::::::.........---:.                                
                               ..:...........::::::::::::::::::::::............---...                              
                               ...............::::::::...:::::::::.............:--...                              
                               ................:::::.......:::::.....................                              
                               ..................:...................................                              
                               ......................................................                              
                               ......................................................                              
                               ......................................................                              
                               ......................................................                              
                               ....................................................                                
                                 ..................................................                                
                                 ..................................................                                
                                 .................................................                                 
                                  ................................................                                 
                                    ............................................                                   
                                    ...........................................                                    
                                     ........................................                                      
                                       ......................................                                      
                                        ....................................                                       
                                             ..........................                                            
                                                ...................                                                
                                                       ....`
    },
    {
      name: 'Fledgling',
      feedsNeeded: 12,
      message: "Feathers are coming in nicely. It's getting an appetite!",
      art: `                                        
                                   ..........                                                       
                              ....................                                                  
                           ..........................                                               
                         ..............................                                             
                        .................................                                           
                      ....................................                                          
                     ......................................                                         
                     ........................................                                       
                    .........................................       ..........                      
                    ..................................................................              
                   .....................................................................            
                   .....................................................................            
                 -++-....................................................................           
               =+++++=...................................................................           
             =++++++++:..................................................:--=-...........           
           -++++++++++................................................--======...........           
          .++++++++++-..........................................:-===========:..........            
                   ..................................-======================-...........            
                   ................................:=======================-:..........             
                    ...............................-=======================:...........             
                    ...............................-======================............              
                     ..............................-====================-............               
                     ...............................===================:............                
                      ...............................===============-:.............                 
                       ................................-========-:................                  
                         .......................................................                    
                          .....................................................                     
                            .................................................                       
                              .............................................                         
                                 .......................................                            
                                     ...............................                                
                                       -::.....................                                     
                                       ==-             :--                                          
                                      .==:             -=-                                          
                                      .==:            .-=-                                          
                                      :==:            .==-                                          
                                      -==.            .==-                                          
                                      -==.        .:---==-                                          
                                -==========-:   =============-.                                     
                                --::===---===== ....==-:.::--==.                                    
                                    ==.      .      .:`
    },
    {
      name: 'Young Rooster',
      feedsNeeded: 18,
      message: "It's starting to crow... sort of. 'Cock-a-doodle... squeak?'",
      art: `                                                                                                    
                                                      .   +**.                                      
                                                    %*=+%#=-=%*%%.                                  
                                                   **-----------=%-                                 
                                                   *==-----------=*                                 
                                                   *#==++++===---=#.                                
                                                   :%#+:...-*##+==*                                 
                                                 :#+           =%%=                                 
                                                 #=             .#=                                 
                                                .*.        -#+   -*                                 
                                                :+        :*@%.  *%*                                
                                                 +         =%=.-:..:*%                              
                                                 ==           :=--=+**#                             
                                                  +-         .-===#+                                
                           ###*                   -%        -===--+#:                               
                       #%%%*:.:%-                 -%       .#*====+%:                               
                      .#+:.+*:..+-                +-        .#%#*##:                                
                      +#%*-.:#+:.++              +*.         .*:                                    
                      **:+%+:.=#-.#+           *=:.   ..      :*.                                   
                     +%%#=:#*-.-#:.#+    *%%%#++#%%-.:*: :+.   ++                                   
                     +%-+%=-=#=:==..:*%#=..........+%==*+#*#-. -%                                   
                      :#*-*#=-*+----=#+=--::::::::::-#-::::::+*#%                                   
                        =#*=*+-----*#****-:::::::::::#+::::::::=%                                   
                        =%=--=*---##----##*::::::::::%=::::::::+=                                   
                          -###=----=#%%#*%-:::::::::%*::::::::=%.                                   
                               =*+-=#=---*#===:::-+#=::::::::=#:                                    
                                 *+=%*-----=##**##+-:::::::-**                                      
                                  *#+=+#%#*==----::::::::*%=                                        
                                    *#=-----::::::::-#===#+                                         
                                     -#+=-:::::::::-#=+##-                                          
                                       :+#*+=::::-+%%=:                                             
                                            +*=#*#==%                                               
                                            .#-:#-*-=*                                              
                                             ==:*+=*-=#.                                            
                                           .:+#::#*%=-+#--:                                         
                                          *=--::::--=%+===+#+                                       
                                          =%%%%%%%%%%%%%%%%%=`
    },
    {
      name: 'Magnificent Rooster',
      feedsNeeded: Infinity,
      message: "The King of the Barnyard! Majestic in every way.",
      art: `                                                                                                           
                 .   =-                                                                             
               .+=-=++==+=                                                                          
            :+==+++++++++-                                                                          
            -++++++++++=                                                                            
          :+++++=:.....                                                                             
          .++++:.:.   ....                                                                          
           :=-:.:=:.     ..                                                                         
         .::::-=..         ..                                            -==========:               
        ::----+++++:        ..                                       :=============-. ..            
             -++++++-        ...                                   -++=-====--::-=======-.          
             =++++++=          ...                               :+++===-           -=====.         
             -++++++:.         ....                             =++==========-===:    -====.        
              :+++=:.           .....                         .+++=================-.  :====        
               .::..             ......                      .++======++++++++++++===:  .===.       
                           .      .....-:                    ++====+++++-.    :=++++==:  .==.       
                 ..         ...  .   ...-=-.                ++===+++=.  .... ....=++++=   .-        
                ..           ......    .:-===-:            =+==+++-.......     ...:++++:            
                ..   ..       .......   .:========-:      :=-----:...               =++:            
               ....  ...    ......::::..:-==================:::::::-========-.       .-             
           ........   ... .........:======================--::::::.......:-=-:==.                   
           ..........................:====================-::::.............:-====.                 
            ...........................-===================:...............  .:====.                
               ..........................-============----:.....................====                
               ............................:-==========:............::...  ......-==-               
                ......................::::.....:======-............:::::..   ....:==-               
                ...............:-....-=:::::::..............:::::::::::....   ... :=-               
                 ..............:-==-======----:::::::::::::::::::::::::....   ...  :                
                  ...   ........::-===============-::::::::::::::::::::.. ..   ..                   
                   ...............::-================-:::::::::::::..::.   .   .                    
                    ................:::--============-::::::::-::::..::.                            
                      ..................::::::---:::::::::-===-::::.....                            
                        ...........  ......:::::::::::::--===:.::::. ...                            
                           .................::::::-=========.  .::..                                
                              ..................:=========-     :..                                 
                                 -:..........:-=========-                                           
                                  -+++++++++-=========:                                             
                                    :++++=    .-====-                                               
                                      =+=       .++.                                                
                                      =+:        ++                                                 
                                      -+:        =+                                                 
                                      -+:        =+                                                 
                                      -+=       .=+.                                                
                               :=-:.-++=--=-=++++=====.                                             
                                 :--.      --:                                                      
                               `
    }
  ]

  // Fun rooster facts
  const facts = [
    "Roosters can recognize over 100 individual faces, including humans.",
    "A rooster's crow can be heard up to 5 miles away under the right conditions.",
    "Roosters have been used as weather predictors for centuries in folklore.",
    "The rooster is the 10th animal in the Chinese zodiac cycle.",
    "Roosters perform a special dance called 'tidbitting' to attract hens.",
    "A group of roosters is technically called a 'bachelor flock'.",
    "Chickens are the closest living relatives to the T-Rex!",
    "Roosters have a built-in biological clock that prompts them to crow at dawn.",
    "A rooster's wattle helps keep it cool in hot weather."
  ]

  // Premium Vibrant Styling
  const styles = {
    // Massive Rainbow/Red Title
    title: 'font-size: 50px; font-weight: 900; background: linear-gradient(to right, #ff0000, #ff8800, #ffd700); -webkit-background-clip: text; color: transparent; padding: 20px 0; line-height: 1.2;',
    // Headers
    header: 'font-size: 18px; font-weight: 900; color: #ff0000; border-bottom: 3px solid #ff0000; padding-bottom: 5px; margin-bottom: 10px; text-transform: uppercase;',
    // Interaction Buttons (Game Feel)
    button: 'background: #ff0000; color: #fff; padding: 6px 12px; border-radius: 6px; font-family: monospace; font-weight: bold; cursor: pointer; border: 2px solid #ff4400;',
    // Text
    text: 'color: #ffffff; font-family: system-ui, sans-serif; font-size: 14px; line-height: 1.6; font-weight: 500;',
    // Highlights
    highlight: 'color: #ff0000; font-weight: 900;',
    secondary: 'color: #ff8800; font-weight: bold;',
    success: 'color: #00aa00; font-weight: bold; font-size: 16px;',
    // Art
    art: 'color: #ffffff; font-family: monospace; font-weight: bold; line-height: 1.0; font-size: 12px;',
  }

  // --- Helpers ---

  const getCurrentStageIndex = () => {
    let acc = 0
    for (let i = 0; i < stages.length; i++) {
      acc += stages[i].feedsNeeded
      if (state.feeds < acc || i === stages.length - 1) return i
    }
    return stages.length - 1
  }

  const getProgress = () => {
    const idx = getCurrentStageIndex()
    if (idx === stages.length - 1) return { percent: 100, current: 0, total: 0 }

    let prevFeeds = 0
    for (let i = 0; i < idx; i++) prevFeeds += stages[i].feedsNeeded

    const currentInStage = state.feeds - prevFeeds
    const neededInStage = stages[idx].feedsNeeded

    return {
      current: currentInStage,
      total: neededInStage,
      percent: Math.min(100, Math.floor((currentInStage / neededInStage) * 100))
    }
  }

  // --- Game Methods ---

  const game = {
    feed: () => {
      const oldIdx = getCurrentStageIndex()
      state.feeds++
      saveState(state)
      const newIdx = getCurrentStageIndex()

      const stage = stages[newIdx]
      const progress = getProgress()

      console.clear()
      console.log(`%cüåΩ You fed the ${stage.name}!`, styles.success)
      console.log(`%c${stage.art}`, styles.art)

      if (newIdx > oldIdx) {
        console.log(`%c\nüéä EVOLUTION COMPLETE! Your rooster has grown! üéä`, styles.title)
      }

      console.log(`%c${stage.message}`, styles.text)

      // Only show progress if not max level
      if (newIdx < stages.length - 1) {
        const barLength = 25
        const filled = Math.round((progress.percent / 100) * barLength)
        const empty = barLength - filled
        const bar = '‚ñà'.repeat(filled) + '‚ñë'.repeat(empty)
        console.log(`\n%cGrowth: [${bar}] ${progress.percent}%`, styles.highlight)
        console.log(`%c(${progress.current}/${progress.total} feeds to next stage)`, styles.text)
      } else {
        console.log(`\n%cüëë MAXIMUM LEVEL REACHED! üëë`, styles.highlight)
      }

      return 'üåΩ Nom nom!'
    },

    status: () => {
      const idx = getCurrentStageIndex()
      const stage = stages[idx]
      const progress = getProgress()

      console.clear()
      console.log('%cüêì ROOSTER STATUS', styles.header)
      console.log(`%c${stage.art}`, styles.art)

      console.log(`%cNAME:  %c${stage.name}`, styles.highlight, styles.text)
      console.log(`%cFEEDS: %c${state.feeds}`, styles.highlight, styles.text)

      if (idx < stages.length - 1) {
        const barLength = 20
        const filled = Math.round((progress.percent / 100) * barLength)
        const bar = '‚ñà'.repeat(filled) + '‚ñë'.repeat(barLength - filled)
        console.log(`%cNEXT:  %c[${bar}] ${progress.current}/${progress.total}`, styles.highlight, styles.text)
      } else {
        console.log(`%cSTATUS:%c FULLY GROWN LEGEND`, styles.highlight, styles.secondary)
      }
      return 'üêì Status loaded'
    },

    fact: () => {
      const f = facts[Math.floor(Math.random() * facts.length)]
      console.log(`%c\nüí° DID YOU KNOW?`, styles.highlight)
      console.log(`%c"${f}"\n`, styles.text)
      return 'üí° Learned!'
    },

    reset: () => {
      state = { feeds: 0, stage: 0, hatched: false }
      saveState(state)
      console.clear()
      game.welcome() // Show welcome screen on reset
      return 'üîÑ Reset'
    },

    welcome: () => {
      console.clear()
      console.log('%cWELCOME TO ROOSTER!!', styles.title)

      console.log(`%c\nWelcome to the specialized console game.`, styles.text)
      console.log(`%cYour mission: Feed your mystery egg until it becomes a legend.`, styles.text)
      console.log(`%cWarning: Highly Addictive üêî`, styles.secondary)

      console.log('%c\nüéÆ COMMANDS:', styles.header)
      console.log(`%crooster.feed()   %cüëâ Feed your bird`, styles.button, styles.text)
      console.log(`%crooster.status() %cüëâ Check growth`, styles.button, styles.text)
      console.log(`%crooster.fact()   %cüëâ Random trivia`, styles.button, styles.text)
      console.log(`%crooster.help()   %cüëâ Show this menu`, styles.button, styles.text)

      return 'üêì Ready!'
    },

    help: () => {
      return game.welcome()
    },

    // Getter for "clear" to act as a command without ()
    get clear() {
      console.clear()
      return 'Console cleared'
    }
  }

  // Automatic "Call to Adventure" on load
  setTimeout(() => {
    game.welcome()
  }, 2500)

  return game
}

// Initialize and expose globally
if (typeof window !== 'undefined') {
  window.rooster = roosterGame()
}

export default roosterGame
